# h5) Nimekäs


## a) Kotisivu
*<h3>[Tehtävänanto](https://terokarvinen.com/linux-palvelimet/#h5-nimekas): Tee vähintään kolmen erillisen weppisivun kotisivu ja kopioi se näkymään palvelimellesi. Jos sinulla on oikea palvelin Internetissä, kannattaa käyttää sitä. Käytä name based virtual hosting tekniikkaa. Sivujen muokkaamisen pitää onnistua ilman pääkäyttäjän oikeuksia, niiden kopioiminen pääkäyttäjänä testisivun paikalle ei käy. Kotisivujen ei tarvitse olla hienoja, mutta niiden tulee olla validia HTML:ää ja linkittää toisiinsa.</h3>*

Edellisessä tehtävässä olin julkaissut kotisivuni /var/www-hakemistosta, mutta yleisintä lienee kuitenkin julkaista kotihakemistossa oleva kansio, joten lähdin yrittämään sitä.

Päädyin asentamaan apachen uudelleen sillä en ollut varma, olinko tehnyt jotain raportoimattomia muutoksia edellisessä tehtävässä, jotka olisivat saattaneet vaikuttaa tämän tehtävän onnistumiseen. Tein sen komennoilla 'sudo apt-get remove --purge apache2' sekä 'sudo apt-get autoremove'. Ensimmäinen poisti kaiken kyseiseen pakettiin liittyvän ja toinen poisti "orvoiksi" jääneet paketit, eli apache2-paketin vanhat riippuvuudet. Tämän jälkeen asensin apachen uudestaan komennoilla 'sudo apt-get update' ja 'sudo apt-get install apache2'.

Asennuksen jälkeen luin läpi apachen ohjeen (default-sivu), joka löytyi kotisivultani asennuksen jälkeen. Tästä ohjeesta poimin tiedon oman kotihakemistossa olevan kansion whitelistaamisesta, sillä lähtökohtaisesti ainoastaan /var/www- ja /usr/share-hakemistoihin pääsee webistä. 

<br/><br/>
<img width="805" alt="image" src="https://github.com/user-attachments/assets/4c97b654-c3a3-4192-ba6b-c782a1bacba9">
<br/><br/>

Päätin muuttaa '/usr/share' -hakemiston --> '/home/mathias/publicsites' -hakemistoksi, johon olin ajatellut laittaa weppisivuni. Tein muutoksen 'apache2.conf' -tiedostoon komennolla 'sudoedit /etc/apache2/apache2.conf'.

Tämän jälkeen loin uuden konffitiedoston 'suontaa.com.conf' hakemistoon '/etc/apache2/sites-available/'.

<br/><br/>
<img width="584" alt="image" src="https://github.com/user-attachments/assets/79664c8a-8613-4170-841a-23d389bcc8c0">
<br/><br/>

Aktivoin uuden konfiguraation komennolla 'sudo a2ensite suontaa.conf' ja käynnistin apachen uudelleen komennolla 'sudo systemctl restart apache2'.

Tämän jälkeen suunnistin selaimella osoitteeseen 'http://suontaa.com', jossa vastauksena tuli sivustoni, johon olin lisännyt tervehdyksen.

<br/><br/>
<img width="531" alt="image" src="https://github.com/user-attachments/assets/a4282385-d817-4665-a5e4-94646928e847">
<br/><br/>

Tein myös toiselle verkkotunnukselleni 'suontaa.me' oman konffitiedoston, jossa ohjataan samalle verkkosivulle.

<br/><br/>
<img width="770" alt="image" src="https://github.com/user-attachments/assets/eefd1800-4dba-4837-bfae-ad472e4ecfe2">
<br/><br/>

### Kaksi weppisivua lisää

Lähdin kokeilemaan tätä luomalla kaksi uutta konffitiedostoa tuleville alidomaineille, jotka tulivat olemaan memes.suontaa.com ja weather.suontaa.com. Kopioin olemassaolevan konffitiedoston kahdeksi eri tiedostoksi ja muokkasin sisällön oikeaksi.

<img width="438" alt="image" src="https://github.com/user-attachments/assets/d48c1ec1-d298-4998-bc85-ac9bceb34364">
<br></br>
<img width="448" alt="image" src="https://github.com/user-attachments/assets/b6ccb086-56b7-4c04-b49e-814db338ffd6">
<br></br>
Tämän jälkeen menin luomaan sivut.

'cd /home/mathias/publicsites'

'mkdir memes.suontaa.com' ja 'mkdir weather.suontaa.com'

Loin molempiin kansioihin omat index.html-tiedostot, joihin lisäsin sisältöä.

Tämän jälkeen aktivoin sivut 'sudo a2ensite weather.suontaa.com' sekä 'sudo a2ensite memes.suontaa.com', jonka jälkeen tein vielä reloadin apachelle komennolla 'sudo systemctl reload apache2'.

Tämän jälkeen lähdin luomaan uudet alidomainit uusille weppisivuilleni.


## b) Alidomain. 

### [Tehtävänanto](https://terokarvinen.com/linux-palvelimet/#h5-nimekas): Tee kaksi uutta alidomainia, jotka osoittava omaan koneeseesi. Esimerkiksi palvelu on example.com -> linuxkurssi.example.com. Tee toinen alidomain A-tietueella ja toinen CNAME-tietueella. Alidomainit ovat tyypillisesti ilmaisia, kun sinulla on päädomain (example.com).

Lähdin ensimmäisenä lukemaan namecheapin omia [ohjeita](https://www.namecheap.com/support/knowledgebase/article.aspx/9776/2237/how-to-create-a-subdomain-for-my-domain/) alidomainien lisäämiseksi. Päädyin ensin tekemään A-tietueen memes.suontaa.com-osoitteelle.
<br></br>
<img width="1117" alt="image" src="https://github.com/user-attachments/assets/185d970c-8a91-4407-b6c3-ac4a8996dac6">
<br></br>
Selaimella kokeilemalla tuli vastaukseksi "Can't find the server", joten kokeilin komentoa 'host memes.suontaa.com dns1.registrar-servers.com' joka palautti oikeat nimipalvelimet sekä palvelimen osoitteen. Seuraavaksi lähdin tekemään CNAME-tietuetta weather.suontaa.com-sivustolle.

Lisäsin CNAME-tietueen host-tiedon ohjeen mukaan:
<br></br>
<img width="1109" alt="image" src="https://github.com/user-attachments/assets/49e1cdcb-ca46-4e01-b105-e9bdccbd9e36">
<br></br>
Vajaan vartin päästä pääsin näkemään sivut myös omalta selaimelta. Sivut löytyy osoitteesta suontaa.com (alisivut memes.suontaa.com ja weather.suontaa.com).

## c) Pubkey. 

### [Tehtävänanto](https://terokarvinen.com/linux-palvelimet/#h5-nimekas): Automatisoi kirjautuminen julkisella SSH-avaimella.


Kävin ensin lukemassa julkisten SSH-avainten käyttämisestä autentikoinnissa [täällä](https://www.ssh.com/academy/ssh/public-key-authentication). Tämän jälkeen etsin netistä ohjeita julkisen SSH-avaimen luomiseen ja päädyin DigitalOceanin [ohjeeseen](https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys-on-debian-11). Ohjeet näyttivät samalta, kuin mitä Tero demosi tunnilla.

Lähdin luomaan ykistyistä avainta komennolla 'ssh-keygen'. Painoin enter, jolloin avainpari tallentui /home/mathias.ssd -hakemistoon. Tämän jälkeen syötin tunnuslauseen, jonka kävin generoimassa [täällä](https://www.useapassphrase.com), jonka syötin komentokehotteeseen. Nyt minulla oli yksityinen SSH-avainpari kotihakemistossani, joka oli suojattu tunnuslauseella.

Tarkistin vielä kotikansiossani komennolla 'ls -a', että .ssh-kansio näkyy (ls -a, eli "all" näyttää myös piilotetut tiedostot ja kansiot).

![image](https://github.com/user-attachments/assets/250a8501-d3ad-4ba3-87fa-9a3732df89b8)

Tässä vaiheessa tehtävää tajusin, että tallensin julkisen ja yksityisen avaimen virtuaalikoneelleni, mikä ei vaikuttanut järkevältä. SSH-avain pitäisikin ilmeisesti luoda omalla koneella, jonka jälkeen julkinen avain siirretään virtuaalikoneelle (palvelimelle). Joten aloitin alusta katkaisemalla yhteyden ja loin avaimen Macilleni samalla komennolla 'ssh-keygen'. Tässä vaiheessa seurasin seuraavaa DigitalOceanin [ohjetta](https://www.digitalocean.com/community/tutorials/how-to-create-ssh-keys-with-openssh-on-macos-or-linux). Ohje oli muuten sama, mutta alussa kerrottiin, että avain tulee luoda lokaalisti omalla koneella.

Toistin samat stepit kuin äsken, ja nyt minulla oli avainparit tallennettuna kotikoneellani ja yksityinen avain suojattuna tunnuslauseella.

Seuraavaksi lähdin kopioimaan julkisen avaimen palvelimelle komennolla 'ssh-copy-id mathias@20.82.182.227'. Syötin VM:n mathias-käyttäjän salasanan ja sain vahvistuksen, että avain on kopioitu.
<br></br>
<img width="531" alt="image" src="https://github.com/user-attachments/assets/4334c767-8f91-458d-8367-9a7783409c21">
<br></br>
Sen jälkeen otin yhteyden palvelimeen ja kirjoitin tunnuslauseen, jonka avulla yksityinen avain yhdistettynä julkiseen avaimeen päästin minut sisään.
<br></br>
<img width="567" alt="image" src="https://github.com/user-attachments/assets/d00559d3-2246-402f-b1f9-34c8b646d3d6">
<br></br>

Tämän jälkeen poistin vielä palvelimelta mahdollisuuden kirjautua salasanalla. Ohjeet tähän löysin ensimmäisestä [artikkelista](https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys-on-debian-11). Komennolla 'sudoedit /etc/ssh/sshd_config pääsin asetustiedostoon, jossa tarkistin seuraavan kohdan:

<img width="470" alt="image" src="https://github.com/user-attachments/assets/c10df060-dff7-4793-8b23-5f4c6e2adf67">

Salasanakirjautuminen oli jo deaktivoitu, mikä herätti kysymyksen, oliko SSH-avaimen lisääminen tehnyt tämän jo?

Kokeilin vielä käynnistää SSH:n uudelleen ja kokeilla, josko salasanalla pystyisi vielä kirjautumaan:

<img width="568" alt="image" src="https://github.com/user-attachments/assets/736bab71-421e-4e34-bcfb-4d6a05211b52">

Onnistui kirjautuminen salasanalla, eli jokin oli vielä pielessä asetustiedostossa. Etsin netistä tietoa, mutta kaikissa sanottiin samaa, että "PasswordAuthentication no" riittäisi salasanalla kirjautumisen poistamiseen. Luin myös man-sivun läpi, mutta en löytänyt aiheesta mitään uutta ja mullistavaa. Otan asian esille tunnilla.



## d) Tutki jonkin nimen DNS-tietoja 'host' ja 'dig' -komennoilla.

### [Tehtävänanto](https://terokarvinen.com/linux-palvelimet/#h5-nimekas): Käytä kumpaakin komentoa kaikkiin nimiin ja vertaa tuloksia. Katso man-sivulta, miten komennot toimivat - esimerkiksi miten 'dig' näyttää kaikki kentät. Analysoi tulokset. Etsi tarvittaessa uusia lähteitä haastaviin kohtiin. Sähköpostin todentamiseen liittyvät SPF ja DMARC -tietojen yksityiskohdat on jätetty vapaaehtoiseksi lisätehtäväksi. Tutkittavat nimet:
- Oma domain-nimesi. Vertaa tuloksia nimen vuokraajan (namecheap.com, name.com...) weppiliittymässä näkyviin asetuksiin.
- Jonkin pikkuyrityksen, kerhon tai yksittäisen henkilön weppisivut. (Ei kuitenkaan kurssikaverin tällä viikolla vuokrattua nimeä).
- Jonkin suuren ja kaikkien tunteman palvelun tiedot.

Kokeilin ensin molempia komentoja suontaa.com -osoitteeseen ja huomasin, että dig-komentoa ei löydy. Googlailin ja päädyin tälle [sivustolle](https://linuxize.com/post/how-to-use-dig-command-to-query-dns-in-linux/), jossa kerrotaan työkalusta ja sen asentamisesta. Asensin paketin komennolla 'sudo apt update && sudo apt install dnsutils'.

Aloitetaan dig-komennolla. 'dig all suontaa.com' näyttää kaikki kentät.

<br></br>
<img width="540" alt="image" src="https://github.com/user-attachments/assets/745afb89-9354-4978-ade0-13a296e97df7">
<br></br>

Ensimmäisellä rivillä nähdään dig-työkalun versio, sekä

# Tehtävän aikana heränneet kysymykset:

1. Jos kone, johon yksityinen SSH-avain on tallennettu, hajoaa tai katoaa, palvelimelle ei pääse enää ikinä (paitsi minun tapauksessani vielä toistaiseksi salasanalla). Tämä herättää oikeastaan kaksi kysymystä: 
- Palvelimen varmuuskopiointi pitäisi vissiin tehdä, mutta onko varmuuskopiosta hyötyä, jos SSH-avain katoaa?
- SSH-avaimen säilytys jossain password-managerissa, onko se turvallista ja suotavaa, jos ohjelma on suojattu esim. tunnuslauseella?


# Lähteet

Tehtävänanto: https://terokarvinen.com/linux-palvelimet/#h5-nimekas

Alidomainin lisääminen, Namecheap: https://www.namecheap.com/support/knowledgebase/article.aspx/9776/2237/how-to-create-a-subdomain-for-my-domain/

Julkisen SSH-avaimen käyttäminen autentikoinnissa: https://www.ssh.com/academy/ssh/public-key-authentication

Julkisen SSH-avaimen luonti Debianille: https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys-on-debian-11

Toinen artikkeli SSH-avaimen luomisesta, jota päädyin lopulta käyttämään: https://www.digitalocean.com/community/tutorials/how-to-create-ssh-keys-with-openssh-on-macos-or-linux

dig-komento: https://linuxize.com/post/how-to-use-dig-command-to-query-dns-in-linux/
