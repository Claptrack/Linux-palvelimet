# h4) Maailma kuulee, virtuaalikoneen asennus pilveen

Päädyin käyttämään Microsoft Azuren palveluita, koska sinne pystyi kirjautumaan koulun sähköpostilla ja saamaan education-edut suoraan ilman Githubia välikätenä (minulla on Github Education aktiivisena, mutta DigitalOcean laittoi tilin lukkoon heti kirjautumisen yhteydessä ja Azuren education-etujen aktivoimiseen tarkoitettu linkki Github sivulla ei toiminut...).

Azure tarjoaa ison liudan palveluita opiskelijoille ilmaiseksi, mutta tätä tehtävää varten valitsin "Linux Virtual Machine".

<img width="1680" alt="image" src="https://github.com/user-attachments/assets/655b4d71-fe99-4c99-97fd-717dc85434db">

Annoin virtuaalikoneelle nimen, valitsin lähimmän mahdollisen alueen, jotta latenssi olisi mahdollisimman pieni, sekä valitsin käyttöjärjestelmäksi Debian 11:n.

<img width="775" alt="image" src="https://github.com/user-attachments/assets/4960f03a-0115-49c9-9640-f46dfb01f7fc">

Valitsin itselleni käyttäjätunnuksen, salasanan ja mitkä portit avataan ulkopuoliselle liikenteelle (tämä ei vielä avaa koneelle asennettavan palomuurin portteja).

![image](https://github.com/user-attachments/assets/72cba5a9-0f7d-42d5-87fa-898674bff059)

Ennen vahvistamista palvelu varoitti minua porttien avaamisesta, mutta tulin siihen tulokseen, että ainakin portti 22 on pidettävä auki, jotta saan virtuaalikoneeseen etäyhteyden. Päätin mennä takaisin alkuun ja valitsin ainoastaan portin 22 etäyhteyden saamiseksi. Menin sen jälkeen viimeiseen vaiheeseen ja painoin "Create".

Tämän jälkeen pääsin omalle hallintasivulleni ja odotettuani minuutin verran, käyttöjärjestelmä oli asennettu pilviympäristöön. Skippasin tässä vaiheessa suositellut asetukset ja klikkasin "Go to resource".

![image](https://github.com/user-attachments/assets/5cfd3ccd-352b-4aba-93eb-75073437639e)

Tämän jälkeen pääsin virtuaalikoneen hallintasivulle. Koko prosessissa meni arviolta 20 minuuttia ml. opiskelijaetujen aktivoiminen Azuren sivuilla.

![image](https://github.com/user-attachments/assets/0e1b4db9-aaf9-4b64-bc86-57027422d565)

Hallintasivulta näin VM:n (Virtual machine) julkisen IP-osoitteen, joten kokeilin oman koneeni komentoriviltä ottaa etäyhteyden komennolla 'ssh 13.79.34.101'. Vastasin "yes" ja syötin salasanan, jonka jälkeen pääsin sisään virtuaalikoneelleni.

<img width="913" alt="image" src="https://github.com/user-attachments/assets/27d6e3bb-3306-4aa7-a7bb-5568334cc527">

Tämän jälkeen tein tehtävänannossa mainitut toimenpiteet. Päätin ensin asentaa palomuurin.

'sudo apt-get update'

'sudo apt-get install ufw'

'sudo ufw allow 22/tcp'

'sudo ufw allow 80'

'sudo ufw enable'

Tarkistin tämän jälkeen komennolla 'sudo ufw status', että palomuuri on aktiivinen ja että oikeat portit ovat auki.

<img width="389" alt="image" src="https://github.com/user-attachments/assets/ba2e51b9-86be-44eb-a15c-ae04b8bca510">

Sitten loin uuden käyttäjän ja lisäsin sen sudo-ryhmään.

'sudo adduser mathias'

'sudo adduser mathias sudo'

Avasin uuden komentorivin ja kokeilin ottaa yhteyttä uudella käyttäjällä.

<img width="632" alt="image" src="https://github.com/user-attachments/assets/1095047b-e4bf-431e-a1de-32492f2258f9">

Vahvistettuani pääsyn VM:lle uudella käyttäjällä, siirryin sulkemaan root-käyttäjän Teron [ohjeiden](https://terokarvinen.com/2017/first-steps-on-a-new-virtual-private-server-an-example-on-digitalocean/) mukaisesti.

'sudo usermod --lock root'

'sudoedit /etc/ssh/sshd_config'

#PermitRootLogin --> no

<img width="175" alt="image" src="https://github.com/user-attachments/assets/d2d2135a-cb43-437d-adaa-52cac3f1e24b">

Tämän jälkeen päivitin vielä ohjelmat

'sudo apt-get update'

'sudo apt-get upgrade'

Päivittämisen jälkeen käynnistin virtuaalikoneen uudelleen komennolla 'sudo reboot now' ja kirjauduin sisään uudella käyttäjällä.

